{% extends 'base.html' %}

{% block headContent %}
    {{ super() }}
    <link href="/static/assets/custom/create-rule.css" rel="stylesheet">
{% endblock %}

{% block pageTitle %}
    Tambah Data Aturan
{% endblock %}

{% block mainContent %}
<div class="row">
    <!-- column -->
    {% raw %}
    <div class="col-md-8">
        <div class="card" id="main-card">
            <div class="card-body">
                <h4 class="card-title">Input data penyakit</h4>
                <form method="POST" action="/admin/rules/create">

                  <div class="form-group">
                      <label>Penyakit</label>
                      <select class="form-control" v-model="selectedPenyakitId">
                          <option v-for="penyakit in listPenyakit" :key="`penyakit-option-${penyakit.id}`" v-bind:value="penyakit.id">
                            {{ penyakit.nama }}
                          </option>
                      </select>
                  </div>

                    <ul class="list-group">
                        <li v-for="g in listGejala" :key="`gejala-${g.id}`" class="list-group-item row-list form-group">
                            <label>
                                <input type="checkbox" class="form-check-input" v-model="g.selected" style="margin-left: 10px;" />
                                {{ g.nama }}
                            </label>
                            <input type="number" class="form-control" min=0 max=0 step=0.01 v-model="g.weight" />
                        </li>
                    </ul>

                    <button type="button" v-on:click="saveRule" class="btn btn-info btn-lg btn-rounded waves-effect waves-light m-b-40 my-4">Simpan</button>
                </form>
            </div>
        </div>
    </div>
    {% endraw %}
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="/static/assets/custom/vue.js" ></script>
    <script>
        $(document).ready(function () {
            var app = new Vue({
                el: "#main-card",
                data: {
                    hello: 'World',
                    listPenyakit: [ {{ vue['list_penyakit']|safe }} ],
                    listGejala: [ {{ vue['list_gejala']|safe }} ],
                    selectedPenyakitId: null
                },
                methods: {
                    saveRule () {
                        var penyakit_id = this.selectedPenyakitId
                        var gejala = this.listGejala.filter(g => g.selected)
                        var payload = {
                            penyakit_id,
                            gejala
                        }
                        payload = JSON.stringify(payload)
                        var options = {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: payload
                        }

                        fetch("/admin/rules/create", options)
                            .then(() => {
                                window.location = "/admin/rules"
                            })
                            .catch(err => {
                                console.log(err)
                                alert("Terjadi kesalahan")
                                window.location.reload()
                            })
                    }
                }
            })
        })
    </script>
{% endblock %}